SELECT DISTINCT
       P.CASE_CNTR,
       P.MMR_CASE,
       P.SYS_PLTFRM, 
       P.BUS_PLTFRM, 
       P.HIGHEST_CUST_NAME, 
       P.ACCT_OR_BILL_TO,
       P.ACCT_OR_BILL_TO_NAME, 
       P.SHIP_TO, 
       P.ST_NAME,
       P.VENDOR_NAME, 
       P.DECISION_MAKER,
       P.BL_TRIG_MFG_CONT, P.BL_TRIG_MFG_CONT_NAME, P.BL_TRIG_CONT_TYPE, -- is this right for lowest group contract?
       CASE WHEN P.SYS_PLTFRM = 'E1' THEN E1_VAR_COST_OPP
            ELSE AS400_VAR_COST_OPP END AS VAR_COST_OPP
FROM PAL_RPA_PREP P
left JOIN (SELECT SUM(P.PNDG_MMR_OPP) E1_VAR_COST_OPP,
             P.SHIP_TO,
             P.BL_TRIG_MFG_CONT
      FROM PAL_RPA_PREP P
      WHERE P.TEAM_ASSIGNED = 'STRAT' --PICK YOUR TEAM HERE
            AND P.CASE_CNTR =  '4'     --PICK YOUR POOL HERE
            AND P.MMR_TYPE = 'VC'    --PICK YOUR BUCKET HERE
            AND P.SYS_PLTFRM = 'E1'
      GROUP BY P.SHIP_TO, P.BL_TRIG_MFG_CONT) X ON X.SHIP_TO = P.SHIP_TO
                                           AND X.BL_TRIG_MFG_CONT = P.BL_TRIG_MFG_CONT
LEFT JOIN (SELECT SUM(P.PNDG_MMR_OPP) AS400_VAR_COST_OPP,
       P.ACCT_OR_BILL_TO,
       P.BL_TRIG_MFG_CONT
       FROM PAL_RPA_PREP P
       WHERE P.TEAM_ASSIGNED = 'STRAT' --PICK YOUR TEAM HERE
            AND P.CASE_CNTR = '4'        --PICK YOUR POOL HERE
            AND P.MMR_TYPE = 'VC'    --PICK YOUR BUCKET HERE
            AND P.SYS_PLTFRM = 'AS400'
      GROUP BY P.ACCT_OR_BILL_TO, P.BL_TRIG_MFG_CONT) Y ON Y.ACCT_OR_BILL_TO = P.ACCT_OR_BILL_TO
                                                   AND y.BL_TRIG_MFG_CONT = P.BL_TRIG_MFG_CONT
WHERE P.TEAM_ASSIGNED = 'STRAT' --PICK YOUR TEAM HERE
      AND P.CASE_CNTR =  '4'       --PICK YOUR POOL HERE
      AND P.MMR_TYPE = 'VC'    --PICK YOUR BUCKET HERE
      AND P.BL_TRIG_MFG_CONT IS NOT NULL
      AND P.INSRT_DT > SYSDATE -14
